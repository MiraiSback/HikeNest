openapi: 3.0.4
info:
  version: '1.0'
  title: "HikeNest OpenAPI 1.0"
  description: API built to manage group hikes.
  license:
    name: MIT
servers:
  - url: http://localhost:8080/api
    description: Localhost
  - url: http://questositononesiste.com
    description: da cambiare in fase di deploy
paths: 
  /autenticazione:
    post:
      summary: Autenticazione di un utente
      description: Autentica uno user creando un token di sessione JWT
      responses:
        '200' :
          description: Token creato
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: True se l'utente è riuscito ad autenticarsi
                  token:
                    type: string
                    description: Token di autenticazione
                  email:
                    type: string
                    format: email
                    description: Email dell'utente loggato
                  id:
                    type: string
                    description: ID dell'utente loggato
                  self:
                    type: string
                    description: Link all'utente loggato
        '401' : 
          description: Credenziali sbagliate
      requestBody:
        description: Nel body devono essere presenti username e password
        required: true
        content: 
          application/json:
            schema: 
              type: object
              required:
                - mail
                - password
              properties:
                mail:
                  type: string
                  description: Mail dell'utente
                password: 
                  type: string
                  description: Password dell'utente
  /registrazione:
    post:
      summary: Crea un utente con email, username e password
      description: È possibile creare un utente inviando username, email e password al sistema
      requestBody:
        description: Nel body devono essere presenti username, mail e password
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - mail
                - password 
                - username
              properties:
                mail:
                  type: string
                  format: email
                  description: Indirizzo email dell'utente
                password:
                  type: string
                  description: Password dell'utente
                username: 
                  type: string
                  description: Username scelto dall'utente
                bio:
                  type: string
                  description: Biografia scritta dall'utente

      responses:
        '201':
          description: Utente creato!
          content:  
            application/json:
              schema: 
                type: object
                properties:
                  self:
                    type: string
                    description: Link alla nuova risorsa
        '400': 
          description: Errore nella creazione dell'utente
        '409':
          description: L'utente esiste già

  /utenti/{idUtente}:
    get:
      summary: Profilo di un utente
      description: Mostra la pagina del profilo di un utente, mostrando username e bio
      security:
        - BearerAuth: []
      parameters:
        - in : path
          name: idUtente
          required: true
          schema: 
            type: string
          description: ID dell'utente del quale visualizzare il profilo
      responses:
        '200':
          description: Profilo dell'utente trovato
          content: 
            application/json:
              schema:
                $ref: '#/components/schemas/Utente'
        '404':  
          description: Utente non trovato
                
  /gruppi:
    get:
      summary: Lista dei gruppi
      description: Ottieni la lista di tutti i gruppi, per ottenerne uno solo usa /gruppi/{IDgruppo}
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Lista dei gruppi
          content:
            application/json:
              schema: 
                type: array
                items:
                  $ref: '#/components/schemas/Gruppo'
    post:
      summary: Crea un nuovo gruppo
      description: Creazione di un nuovo gruppo inviando i dati necessari
      security:
        - BearerAuth: []
      requestBody:
        description: Nella richiesta vanno inseriti tutti i dati relativi al gruppo
        content:
          application/json:
            schema: 
              $ref: "#/components/schemas/Gruppo"
              #l'id dell'utente verrà preso dal jwt lato server
      responses: 
        '201':
          description: Gruppo creato
          headers: 
            location:
              schema:
                type: string
              description: Link al nuovo gruppo
        '401': 
          description: Utente non autenticato
        '400': 
          description: Dati invalidi
      
    
    
  /gruppi/{IDGruppo}:
    get:
      summary: Pagina di un gruppo
      description: Ottieni informazioni riguardo un singolo gruppo
      security:
        - BearerAuth: []
      parameters:
        - in : path
          name: IDGruppo
          required: true
          schema: 
            type: string
          description: ID del gruppo
      responses:
        '200':
          description: Gruppo trovato
          content:  
            application/json:
              schema:
                $ref: "#/components/schemas/Gruppo" 
        '404':
          description: Gruppo non trovato
        '401': 
          description: Utente non autenticato
  
  /percorsi:
    get:
      summary: Lista di tutti i percorsi
      description: Ottieni la lista completa di tutti i percorsi, eventualmente filtrati per lunghezza
      security:
        - BearerAuth: []
      parameters:
      - in: query #usiamo query per fare /percorsi?minKm=1&maxKm=100 invece che path che consente un solo param
        name: minKm
        schema:
          type: number
          format: float
        required: false
        description: Lunghezza minima del percorso in km
      - in: query
        name: maxKm
        schema:
          type: number
          format: float
        required: false
        description: Lunghezza massima del percorso in km
      - in: query
        name: difficolta
        schema:
          type: string
          enum: [facile, medio, difficile]
        required: false
        description: Difficoltà del percorso da cercare
      - in: query
        name: nome
        schema: 
          type: string
        required: false
        description: Nome totale o parziale del percorso da cercare
      - in: query
        name: localita
        schema: 
          type: string
        required: false
        description: Località del percorso da cercare      
      responses:
        '200':
          description: Lista dei percorsi
          content: 
            application/json:
              schema:
                type: array
                items : 
                  $ref: "#/components/schemas/Percorso"
        '401': 
          description: Utente non autenticato
  /percorsi/{idPercorso}: 
    get: 
      summary: Info su un percorso
      description: Ottieni tutte le informazioni di un percorso partendo dal suo Id
      security:
        - BearerAuth: []
      parameters:
      - in: path
        name: idPercorso
        required: true
        schema:
          type: string
          description: Id del percorso da cercare
      responses:
        '200':
          description: Percorso trovato
          content: 
            application/json:
              schema:
                $ref: '#/components/schemas/Percorso'
        '404':
          description: Percorso non trovato


  /percorsi/{idPercorso}/recensioni:
    get:
      summary: Lista delle recensioni di un percorso
      description: Restituisce una lista contenente tutte le recensioni di un singolo percorso
      security:
        - BearerAuth: []
      parameters:
      - in: path
        name: idPercorso
        required: true
        schema:
          type: string
          description: Id del percorso dal quale cercare le recensioni
      responses:
        '200':
          description: Lista delle recensioni trovate
          content:
            application/json:
              schema: 
                type: array
                items:
                  $ref: '#/components/schemas/Recensione'
        '401': 
          description: Utente non autenticato
    post:
      summary: Crea una nuova recensione
      description: Permette ad un utente di creare una nuova recensione 
      security:
        - BearerAuth: []
      parameters:
      - in: path
        name: idPercorso
        required: true
        schema:
          type: string
          description: Id del percorso del quale inserire una recensione
      requestBody:
        required: true
        content:
          application/json:
            schema: 
              $ref: '#/components/schemas/Recensione'
      responses:
        '201':
          description: Recensione creata
        '400':
          description: Dati forniti non validi
        '401': 
          description: Utente non autenticato

  /percorsi/{idPercorso}/segnalazioni:
    get:
      summary: Lista delle segnalazioni relative ad un percorso
      description: Restituisce la lista di tutte le segnalazioni fornite rispetto ad un percorso
      security:
        - BearerAuth: []
      parameters:
      - in: path
        name: idPercorso
        required: true
        schema:
          type: string
          description: Id del percorso dal quale cercare le segnalazioni
      responses:
        '200':
          description: Lista delle segnalazioni trovate
          content:
            application/json:
              schema: 
                type: array
                items:
                  $ref: '#/components/schemas/Segnalazione'
        '401': 
          description: Utente non autenticato
    post:
      summary: Inviare una nuova segnalazione
      description: Permette ad un utente di inviare una segnalazione relativa ad una problematica su un percorso
      security:
        - BearerAuth: []
      parameters:
      - in: path
        name: idPercorso
        required: true
        schema:
          type: string
          description: Id del percorso menzionato nella segnalazione
      requestBody:
        required: true
        content:
          application/json:
            schema: 
              $ref: '#/components/schemas/Segnalazione'
      responses:
        '201':
          description: Segnalazione registrata
        '400':
          description: Dati forniti non validi
        '401': 
          description: Utente non autenticato

        
  #ID DELL'UTENTE va preso dal jwt
  /gruppi/{idGruppo}/persone:
    post: 
      summary: Aggiunta di un utente ad un gruppo
      description: Un utente viene aggiunto ad un gruppo già esistente
      security:
        - BearerAuth: []
      parameters:
      - in: path
        name: idGruppo
        required: true
        schema:
          type: string
          description: Id del gruppo al quale unirsi
      responses: 
        '201':  
          description: Utente aggiunto
        '400':
          description: Impossibile aggregarsi al gruppo, azione fallita
        '401': 
          description: Utente non autenticato
    get:
      summary: Numero di persone in un gruppo
      description: Ottieni il numero di persone che si sono aggiunte ad un gruppo
      security:
        - BearerAuth: []
      parameters:
      - in: path
        name: idGruppo
        required: true
        schema:
          type: string
          description: Id del gruppo del quale richidere le informazioni sugli utenti
      responses: 
        '200': 
          description: Hai ottenuto i dati richiesti
          content:
            application/json:
              schema:
                type: object
                properties:
                  numeroUtenti:
                    type: integer
                    description: Numero di utenti nel gruppo
        '404':  
          description: Gruppo  non trovato
  
  #questa è una richiesta fatta da un utente loggato
  #invia il suo token e da quello il server ottiene l'id e risponde con i gruppi
  #cosi viene rispettata la privacy
  /gruppi/gruppiUtente:
    get:
      summary: Gruppi a cui un utente appartiene
      description: Elenco di tutti i gruppi a cui un utente appartiene
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Ottenuta la lista di gruppi di un utente
          content:
            application/json:
              schema:
                type: array
                items:  
                  $ref: '#/components/schemas/Gruppo'
        '401':
          description: Token mancante o non valido

      


  

  

components: 

  securitySchemes:
    #formato standard per inviare e ricevere token
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Portatore del token JWT, in formato  Bearer ${token}


  schemas:
  #usa questo schema per restituire uno/più gruppi quando l'utente li richiede
  #idCreatore non è required perchè quando un utente crea il gruppo l'id è ottenuto dal suo jwt
  #ma nelle richieste successive di info sul gruppo invierò idCreatore nel body
    Gruppo:
      type: object
      required: 
        - nome
        - idPercorso
        - esperienza
        - data
        - descrizione
      properties:
        self:
          type: string
          description: "Link al gruppo"
        nome:
          type: string
          description: "Nome del gruppo"
        idPercorso:
          type: string
          description: "Id del percorso associato al gruppo"
        esperienza:
          type: string
          enum : [neofita, medio, esperto]
          description: "Livello di esperienza consigliato a chi partecipa"
        data:
          type: string
          format: date-time
          description: "Data in cui si effettura l'hike"
        utenti:
          type: array
          items:
            type: string
          description: Array di tutti gli utenti che partecipano al gruppo
        idCreatore:
          type: string
          description: Id dell'utente che ha creato il percorso
        descrizione:
          type: string
          description: Descrizione definita al momento della creazione


  #schema unico per i percorsi
    Percorso:
      type: object
      required:
        - nome
        - difficolta
        - lunghezzaKm
        - localitaPartenza
      properties:
        self:
          type: string
          description: Link al percorso
        nome:
          type: string
          description: Nome del percorso
        lunghezzaKm:
          type: number
          format: float
          description: Lunghezza complessiva in chilometri
        difficolta: 
          type: string
          enum: [facile, medio, difficile]
          description: Livello di difficolta del percorso
        localitaPartenza:
          type: string
          description: Località dalla quale parte il percorso

  #idUtente non è required perchè quando viene creata una recensione l'id si prende dal jwt
  #mentre quando vengono lette l'id utente è passato nel body
  #idPercorso non è nello schema perchè è gia presente nell'url
    Recensione:
      type: object
      required: 
        - testo
        - valutazione
      properties:
        self:
          type: string
          description: Link alla recensione
        idUtente:
          type: string
          description: Id dell'utente che ha postato la recensione
        testo: 
          type: string
          description: Testo facente parte della recensione
        valutazione: 
          type: number
          minimum: 1
          maximum: 5
          description: Valore numerico lasciato dall'utente in valutazione al percorso
    
    #come per le recensioni, idUtente non è required
    #idPercorso non è nello schema perchè è gia presente nell'url
    Segnalazione:
      type: object
      required: 
        - testo
      properties:
        self:
          type: string
          description: Link alla segnalazione
        idUtente:
          type: string
          description: Id dell'utente che ha aperto la segnalazione
        testo:
          type: string
          description: Descrizione associata alla segnalazione
    
    Utente: 
      type: object
      required:
        - mail
        - username
        - bio
      properties:
        self: 
          type: string
          description: Link all'utente
        mail:
          type: string
          description: E-mail dell'utente
        username:
          type: string
          description: Username dell'utente
        bio:
          type: string
          description: Biografia impostata dall'utente sul suo profilo
